
import tensorflow as tf
import numpy as np
import matplotlib.pyplot as plt
import tensorflow_hub as hub
from tensorflow.keras.utils import custom_object_scope
from PIL import Image  # Replaces OpenCV

# Load model
with custom_object_scope({'KerasLayer': hub.KerasLayer}):
    model = tf.keras.models.load_model("C:\\Users\\ferna\\Documents\\robocup-rescuemaze-2025-4\\mobilenetModel\\HSU_detection_mobilenetJetson.h5")

# Load image using PIL (instead of OpenCV)
image_path = "C:\\Users\\ferna\\Documents\\vision_artificial\\fotos\\dataset_HSU\\S\\image7.jpeg"
try:
    image = Image.open(image_path).convert("RGB")  # Ensure RGB format
except Exception as e:
    print(f"Error loading image: {e}")
    exit()

# Normalize image
image = np.array(image.resize((224, 224)), dtype=np.float32) / 255.0  # Resize and normalize

# Show image using Matplotlib instead of OpenCV
plt.imshow(image)
plt.axis("off")  # Hide axis
plt.show()

# Perform prediction
result = model.predict(image.reshape(1, 224, 224, 3))  # Reshape for model input
result = np.argmax(result)

# Label mapping
labels = {0: "H", 1: "S", 2: "U", 3: "none"}
detection = labels.get(result, "unknown")

print(detection)
